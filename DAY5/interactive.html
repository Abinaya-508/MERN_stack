<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8" />
    <title>Interactive Notes Manager</title>

    <style>
    :root {
        --bg: #f8f9fa; --text: #212529; --card: white; --border: #dee2e6;
        --primary: #0d6efd; --danger: #dc3545; --success: #198754;
    }
    [data-theme="dark"] {
        --bg: #212529; --text: #e9ecef; --card: #343a40; --border: #495057;
        --primary: #6ea8fe; --danger: #ff6b6b; --success: #51cf66;
    }

    body {
        font-family: system-ui;
        background: var(--bg);
        color: var(--text);
        padding: 20px;
        min-height: 100vh;
    }

    .container { max-width: 700px; margin: auto; }
    header { text-align: center; margin-bottom: 20px; }

    #theme-toggle {
        padding: 8px 16px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
    }

    form { display: flex; gap: 10px; margin-bottom: 15px; }

    #note-input {
        flex: 1;
        padding: 12px;
        font-size: 1.1rem;
        border: 1px solid var(--border);
        border-radius: 6px;
        background: var(--card);
        color: var(--text);
    }

    #add-btn {
        padding: 12px 20px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
    }

    #search {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid var(--border);
        border-radius: 6px;
        background: var(--card);
        color: var(--text);
    }

    #notes-list {
        list-style: none;
        display: grid;
        gap: 12px;
        padding: 0;
    }

    .note {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        cursor: grab;
    }

    .note.completed .text {
        text-decoration: line-through;
        opacity: 0.6;
    }

    .note.dragging {
        opacity: 0.4;
        transform: scale(0.98);
    }

    .actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        align-items: center;
    }

    .btn {
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        color: white;
    }

    .btn-complete { background: var(--success); }
    .btn-delete  { background: var(--danger); }

    .color-picker {
        width: 32px;
        height: 32px;
        border: none;
        cursor: pointer;
    }

    #clear-completed {
        margin-top: 20px;
        background: var(--danger);
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        width: 100%;
    }

    /* Modal */
    #modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        justify-content: center;
        align-items: center;
    }

    .modal-box {
        background: var(--card);
        padding: 24px;
        border-radius: 12px;
        width: 90%;
        max-width: 400px;
        text-align: center;
    }

    .modal-buttons {
        margin-top: 20px;
        display: flex;
        gap: 12px;
        justify-content: center;
    }
    </style>
</head>

<body>

<div class="container">
    <header>
    <h1>Notes Manager</h1>
    <button id="theme-toggle">Dark Mode</button>
    </header>

    <form id="note-form">
    <input id="note-input" placeholder="Type your note..." required />
    <button id="add-btn">Add</button>
    </form>

    <input id="search" placeholder="Search notes..." />

    <ul id="notes-list"></ul>

    <button id="clear-completed">Clear Completed</button>
</div>

<!-- Modal -->
<div id="modal">
    <div class="modal-box">
    <h2>Clear all completed notes?</h2>
    <div class="modal-buttons">
        <button id="modal-no" class="btn" style="background:#6c757d;">No</button>
        <button id="modal-yes" class="btn btn-delete">Yes</button>
    </div>
    </div>
</div>

<script>
/* =========================
    SELECT ELEMENTS
========================= */
const themeToggle = document.getElementById("theme-toggle");
const noteForm = document.getElementById("note-form");
const noteInput = document.getElementById("note-input");
const notesList = document.getElementById("notes-list");
const searchInput = document.getElementById("search");
const clearCompletedBtn = document.getElementById("clear-completed");

const modal = document.getElementById("modal");
const modalYes = document.getElementById("modal-yes");
const modalNo = document.getElementById("modal-no");

let draggedNote = null;

/* =========================
     THEME TOGGLE
========================= */
themeToggle.addEventListener("click", () => {
    const html = document.documentElement;
    const dark = html.getAttribute("data-theme") === "dark";
    html.setAttribute("data-theme", dark ? "light" : "dark");
    themeToggle.textContent = dark ? "Dark Mode" : "Light Mode";
});

/* =========================
     ADD NOTE
========================= */
noteForm.addEventListener("submit", (e) => {
    e.preventDefault();
    addNote(noteInput.value.trim());
    noteInput.value = "";
});

function addNote(text) {
    if (!text) return;

    const li = document.createElement("li");
    li.className = "note";
    li.draggable = true;

    li.innerHTML = `
    <span class="text">${text}</span>
    <div class="actions">
        <input type="color" class="color-picker" />
        <button class="btn btn-complete">Complete</button>
        <button class="btn btn-delete">Delete</button>
    </div>
    `;
    
    notesList.prepend(li);
}

/* =========================
    EVENT DELEGATION
========================= */
notesList.addEventListener("click", (e) => {
    const note = e.target.closest(".note");
    if (!note) return;

    if (e.target.classList.contains("btn-delete")) note.remove();
    if (e.target.classList.contains("btn-complete")) note.classList.toggle("completed");
});

notesList.addEventListener("change", (e) => {
    if (e.target.classList.contains("color-picker")) {
    e.target.closest(".note").style.backgroundColor = e.target.value;
    }
});

/* =========================
    DOUBLE CLICK EDIT
========================= */
notesList.addEventListener("dblclick", (e) => {
    if (!e.target.classList.contains("text")) return;

    const span = e.target;
    const input = document.createElement("input");
    input.value = span.textContent;
    input.style.width = "100%";

    span.replaceWith(input);
    input.focus();

    input.addEventListener("blur", () => saveEdit(input, span));
    input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") saveEdit(input, span);
    });
});

function saveEdit(input, span) {
    span.textContent = input.value || "Untitled note";
    input.replaceWith(span);
}

/* =========================
    LIVE SEARCH
========================= */
searchInput.addEventListener("input", () => {
    const value = searchInput.value.toLowerCase();
    document.querySelectorAll(".note").forEach(note => {
    const text = note.querySelector(".text").textContent.toLowerCase();
    note.style.display = text.includes(value) ? "" : "none";
    });
});

/* =========================
    DRAG & DROP
========================= */
notesList.addEventListener("dragstart", (e) => {
    if (!e.target.classList.contains("note")) return;
    draggedNote = e.target;
    e.target.classList.add("dragging");
});

notesList.addEventListener("dragend", (e) => {
    e.target.classList.remove("dragging");
    draggedNote = null;
});

notesList.addEventListener("dragover", (e) => {
    e.preventDefault();
    const target = e.target.closest(".note");
    if (!target || target === draggedNote) return;

    const rect = target.getBoundingClientRect();
    const after = (e.clientY - rect.top) > rect.height / 2;
    notesList.insertBefore(draggedNote, after ? target.nextSibling : target);
});

/* =========================
    MODAL + CLEAR COMPLETED
========================= */
clearCompletedBtn.addEventListener("click", () => {
    modal.style.display = "flex";
});

modalNo.addEventListener("click", closeModal);
modal.addEventListener("click", (e) => {
    if (e.target === modal) closeModal();
});

modalYes.addEventListener("click", () => {
    document.querySelectorAll(".note.completed").forEach(n => n.remove());
    closeModal();
});

function closeModal() {
    modal.style.display = "none";
}
</script>

</body>
</html>